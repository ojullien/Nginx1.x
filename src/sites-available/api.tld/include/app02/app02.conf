## -----------------------------------------------------
## NGINX 1.x
## Configuration for PHP application
##
## @Context server
## @Module ngx_http_core_module
## -----------------------------------------------------
#
# Filesystem is:
#
# /var/www/api.tld/public/         => app 001 static web site (url https://api.tld )
# /var/www/api.tld/public/apps/v1.3/public  => api v1 (url: https://api.tld/v1 )
# /var/www/api.tld/public/apps/v2.0/public  => api v2 (url: https://api.tld/v2 )
#
location ~ ^/v1 {
    alias /apps/v1.3/public;

    # Cache headers (see conf.d/expires.conf)
    add_header Cache-Control $expires_cdn;

    # Usual headers
    include sites-available/snippets/headers/headers_for_application.conf;

    # Content Security Policy (CSP)
    include sites-available/api.tld/include/app02/csp.conf;

    # Method control
    include sites-available/snippets/access_control/directives_for_application.conf;

    try_files $uri $uri/ /apps/v1.3/public/index.php?$query_string;

    # Redirection
    include sites-available/api.tld/include/app02/redirect.conf;

}

location ~ ^/v2 {
    alias /apps/v2.0/public;

    # Cache headers (see conf.d/expires.conf)
    add_header Cache-Control $expires_cdn;

    # Usual headers
    include sites-available/snippets/headers/headers_for_application.conf;

    # Content Security Policy (CSP)
    include sites-available/api.tld/include/app02/csp.conf;

    # Method control
    include sites-available/snippets/access_control/directives_for_application.conf;

    try_files $uri $uri/ /apps/v2.0/public/index.php?$query_string;

    # Redirection
    include sites-available/api.tld/include/app02/redirect.conf;

}

# fastcgi
include sites-available/api.tld/include/app02/fastcgi-php.conf;
